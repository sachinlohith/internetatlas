<!DOCTYPE html>
<html>
  <head>
    <style>
       #map {
            height: 735px;
            width: 100%;
       }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC6S8qL6b6A6IIAIIQaVgUJF7Bk9iV0JXc"> </script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  </head>
  <body>
    <h3>Internet Atlas</h3>
    <form id="myForm" action="javascript:initMap()">
        West : <input type=number step=any id="west"> <br>
        East : <input type=number step=any id="east"> <br>
        North : <input type=number step=any id="north"> <br>
        South : <input type=number step=any id="south"> <br>
        Start : <input type=number id="start"> <br>
        End : <input type=number id="end"> <br>
        <input type=submit value="Submit"> <br>
    </form>
    <div id="map"></div>
    <script>
        function initMap() {
            var markers = {};
            var map;
            var west = document.getElementById("west").value ? document.getElementById("west").value : 180.0;
            var east = document.getElementById("east").value ? document.getElementById("east").value : -180.0;
            var north = document.getElementById("north").value ? document.getElementById("north").value : -90.0;
            var south = document.getElementById("south").value ? document.getElementById("south").value : 90.0;
            var start = document.getElementById("start").value ? document.getElementById("start").value : 1;
            var end = document.getElementById("end").value ? document.getElementById("end").value : 273;
            $.getJSON('./geocoded.json', function(data) {
                var uluru = {lat: data[120]["geocode"][0], lng: data[120]["geocode"][1]};
                map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 5,
                    center: uluru
                });
                jQuery.each(data, function(i, val) {
                    if(i >= start && i <= end) {
                        var lat = data[i]["geocode"][0];
                        var lng = data[i]["geocode"][1];
                        if(lat > north && lat < south && lng < west && lng > east ) {
                            console.log("adding to markers");
                            uluru = {lat, lng};
                            var marker = new google.maps.Marker({
                                position: uluru,
                                map: map
                            });
                            markers[i] = marker;
                        }
                    }
                });
                $.get('./InterTubes-Dataset/links.txt', function(data) {
                    data = data.split("\n");
                    jQuery.each(data, function(i, val) {
                        if(data[i]) {
                            var line = data[i].split(",");
                            line = [parseInt(line[0]), parseInt(line[1])];
                            if(line[0] in markers && line[1] in markers) {
                                var link = [markers[line[0]].getPosition(), markers[line[1]].getPosition()];
                                var flightPath = new google.maps.Polyline({
                                    path: link,
                                    strokeColor: '#0000FF'
                                });
                                flightPath.setMap(map);
                            }
                        }
                    });
                });
            });
        }
    </script>
  </body>
</html>
